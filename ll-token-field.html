<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ll-theme/ll-theme.html">
<script type="application/javascript" src="bower_components/lodash/lodash.min.js"></script>

<!--
An element for building tags from an input field

Example:

    <ll-token-field></ll-token-field>

@demo
-->

<!--
  Styles taken from http://sliptree.github.io/bootstrap-tokenfield/
  I would like to extend this further to calculate the size of the input box along with the other validation rules.
-->
<dom-module id="ll-token-field">

  <style>
    :host {
      display: block;
      box-sizing: border-box;
    }

    .tokenfield {
      height: auto;
      min-height: 34px;
      padding-bottom: 0px;
    }
    .tokenfield.focus {
      border-color: #66afe9;
      outline: 0;
      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(102, 175, 233, 0.6);
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(102, 175, 233, 0.6);
    }

    .token {
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
      -webkit-border-radius: 3px;
      -moz-border-radius: 3px;
      border-radius: 3px;
      display: inline-block;
      border: 1px solid #d9d9d9;
      background-color: #fff;
      white-space: nowrap;
      margin: -1px 5px 5px 0;
      height: 22px;
      vertical-align: top;
      cursor: default;
    }

    .token:hover {
      border-color: #b9b9b9;
    }
    .token.active {
      border-color: #52a8ec;
      border-color: rgba(82, 168, 236, 0.8);
    }
    .token .token-label {
      display: inline-block;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-left: 4px;
      vertical-align: top;
      color: #0069A9;
    }
    .token .close {
      font-family: Arial;
      display: inline-block;
      line-height: 100%;
      font-size: 1.1em;
      line-height: 1.49em;
      margin-left: 5px;
      float: none;
      height: 100%;
      vertical-align: top;
      padding-right: 4px;
    }
    .token-input {
      background: none;
      width: 150px;
      border: 0;
      height: 20px;
      padding: 0;
      margin-bottom: 6px;
      -webkit-box-shadow: none;
      box-shadow: none;
    }
    .token-input:focus {
      border-color: transparent;
      outline: 0;
      /* IE6-9 */
      -webkit-box-shadow: none;
      box-shadow: none;
    }

    .inline {
      display: inline-block;
    }
  </style>

  <template>
    <div class="tokenfield form-control" id="tags-container" on-tap="_focusInput">
      <div class="inline">
        <template is="dom-repeat" items="[[tags]]">
          <div class="token">
            <span class="token-label" style="max-width: 770px;">{{item}}</span>
            <a href="#" class="close" tabindex="-1" on-tap="_removeToken">Ã—</a>
          </div>
        </template>
      </div>
      <div class="inline">
        <input placeholder="Enter text here" id="tag-input" type="text" class="token-input" on-keydown="_onKeyPress"/>
      </div>
    </div>

  </template>

</dom-module>

<script>

  Polymer({

    is: 'll-token-field',

    properties: {
      /**
       * Array of tags to be placed before the input field.
       * Can be passed an array for default selections
       */
      tags: {
        type: Array,
        notify: true,
        reflectToAttribute: true,
        value: function() {
          return [];
        }
      }
    },

    _onKeyPress: function(e) {
      var input = this.$$('#tag-input');
      if(e.keyCode ===  9 && input.value !== '') { // TAB
        e.preventDefault();
        e.stopPropagation();
        var newTag = input.value;
        input.value = '';
        this.tags = this.tags.concat(newTag);
        input.focus();
      }
      else if (e.keyCode === 8 && input.value === '') { // Backspace
        this.tags = this.tags.slice(0, -1);
      }
    },

    _removeToken: function(e) {
      var removed = e.model.arrayDelete(this.tags, e.model.item);
      this.tags = _.without(this.tags, removed);
    },

    _focusInput: function() {
      var input = this.$$('#tag-input');
      input.focus();
    }
  });

</script>
