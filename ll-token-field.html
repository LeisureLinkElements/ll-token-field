<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ll-theme/ll-theme.html">
<script type="application/javascript" src="../lodash/lodash.js"></script>

<!--
An element for building tags from an input field

Example:

    <ll-token-field></ll-token-field>

@demo
-->
<dom-module id="ll-token-field">

  <style>
    :host {
      display: block;
      box-sizing: border-box;
    }
    :host div {
      border: 1px solid #B1B1B1;
      width: 100%;
    }
    #tags-container {
      display: inline-block;
      padding: 0% 1%;
    }
    #tag-input-container {
      display: inline-block;
    }
    #tag-input {
      border-style: none;
      background: transparent;
      padding: 0% 1%;
      width: 100%;
    }
    #tag-input:focus {
      outline: 0;
    }
    .token {
      background: rgba(130, 132, 135, .2);
      border-radius: 3px;
      box-shadow: rgba(255,255,255,.2) 0 1px 0 inset,#000 0 1px 3px;
      padding: 0px 10px;
      margin: 0px 2px;
    }
    .token-delete{
      vertical-align: middle;
      border: 0;
      background: 0 0;
      opacity: .2;
      -webkit-appearance: none;
      color: black;
      cursor: pointer;
    }
  </style>

  <template>
    <div>
        <span id="tags-container">
          <template is="dom-repeat" items="[[tags]]">
            <span>
              <span class="token">{{item}}<button id="{{item}}" class="token-delete" on-tap="_removeToken">&times;</button></span>
            </span>
          </template>
        </span>
      <span id="tag-input-container">
          <input id="tag-input" type="text" on-keydown="_onKeyPress" />
      </span>
    </div>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'll-token-field',

    properties: {
      /**
       * Array of tags to be placed before the input field.
       * Can be passed an array for default selections
       */
      tags: {
        type: Array,
        notify: true,
        reflectToAttribute: true,
        value: function() {
          return [];
        }
      }
    },

    _onKeyPress: function(e) {
      var input = this.$$('#tag-input');
      if(e.keyCode ===  9 && input.value !== '') { // TAB
        e.preventDefault();
        e.stopPropagation();
        var newTag = input.value;
        input.value = '';
        this.tags = this.tags.concat(newTag);
        input.focus();
      }
      else if (e.keyCode === 8 && input.value === '') { // Backspace
        this.tags = this.tags.slice(0, -1);
      }
    },

    _removeToken: function(e) {
      var removed = e.model.arrayDelete(this.tags, e.model.item);
      this.tags = _.without(this.tags, removed);
    },
  });

</script>
